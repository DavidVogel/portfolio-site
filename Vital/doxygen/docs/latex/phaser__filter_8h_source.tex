\doxysection{phaser\+\_\+filter.\+h}
\hypertarget{phaser__filter_8h_source}{}\label{phaser__filter_8h_source}\index{/Users/davidvogel/repos/VitalHelp/src/synthesis/filters/phaser\_filter.h@{/Users/davidvogel/repos/VitalHelp/src/synthesis/filters/phaser\_filter.h}}
\mbox{\hyperlink{phaser__filter_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{processor_8h}{processor.h}}"{}}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{synth__filter_8h}{synth\_filter.h}}"{}}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{one__pole__filter_8h}{one\_pole\_filter.h}}"{}}}
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00008\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacevital}{vital}}\ \{}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00019\ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classvital_1_1_phaser_filter}{PhaserFilter}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classvital_1_1_processor}{Processor}},\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classvital_1_1_synth_filter}{SynthFilter}}\ \{}
\DoxyCodeLine{00020\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00024\ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \mbox{\hyperlink{namespacevital_afcc17475a10ef776bbd2f11b64c1ddfb}{mono\_float}}\ \mbox{\hyperlink{classvital_1_1_phaser_filter_a43241d4023f08a4f8fce0a9d44a83f88}{kMinResonance}}\ =\ 0.0f;}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00029\ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \mbox{\hyperlink{namespacevital_afcc17475a10ef776bbd2f11b64c1ddfb}{mono\_float}}\ \mbox{\hyperlink{classvital_1_1_phaser_filter_a40882d94076eac3c339c7126ed56d254}{kMaxResonance}}\ =\ 1.0f;}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00034\ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \mbox{\hyperlink{namespacevital_afcc17475a10ef776bbd2f11b64c1ddfb}{mono\_float}}\ \mbox{\hyperlink{classvital_1_1_phaser_filter_a21db67a373c7f7c01d745b130a8af8d7}{kMinCutoff}}\ =\ 1.0f;}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00039\ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \mbox{\hyperlink{namespacevital_afcc17475a10ef776bbd2f11b64c1ddfb}{mono\_float}}\ \mbox{\hyperlink{classvital_1_1_phaser_filter_a2d232d23563d637e854de3409785b3af}{kClearRatio}}\ =\ 20.0f;}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00044\ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classvital_1_1_phaser_filter_a53fc113b82db4dd79258f170c353fcf0}{kPeakStage}}\ =\ 4;}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00049\ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classvital_1_1_phaser_filter_a1aebd49d7f42fe99c4e6672d329c6ef0}{kMaxStages}}\ =\ 3\ *\ \mbox{\hyperlink{classvital_1_1_phaser_filter_a53fc113b82db4dd79258f170c353fcf0}{kPeakStage}};}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00055\ \ \ \ \ \ \ \mbox{\hyperlink{classvital_1_1_phaser_filter_a04efb8e87fbb545f1ac5b799768b86d1}{PhaserFilter}}(\textcolor{keywordtype}{bool}\ clean);}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00060\ \ \ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classvital_1_1_phaser_filter_a5adc2c2c084141b15b2fb65391a23862}{\string~PhaserFilter}}()\ \{\ \}}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00066\ \ \ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classvital_1_1_processor}{Processor}}*\ \mbox{\hyperlink{classvital_1_1_phaser_filter_a78d783a9337355c1d2a4df864ce5dec8}{clone}}()\textcolor{keyword}{\ const\ override\ }\{\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classvital_1_1_phaser_filter_a04efb8e87fbb545f1ac5b799768b86d1}{PhaserFilter}}(*\textcolor{keyword}{this});\ \}}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00072\ \ \ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classvital_1_1_phaser_filter_a85b5bed3cbe0d38ca4239e69f327f2e1}{process}}(\textcolor{keywordtype}{int}\ num\_samples)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00079\ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classvital_1_1_phaser_filter_a909147fd961b5c3bc463d41bfcbe29fb}{processWithInput}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}*\ audio\_in,\ \textcolor{keywordtype}{int}\ num\_samples)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00085\ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classvital_1_1_phaser_filter_aba06b911834108f8cbe312bcf4838aa9}{setupFilter}}(\textcolor{keyword}{const}\ FilterState\&\ filter\_state)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00091\ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classvital_1_1_phaser_filter_a55f5c526881e1dff88d7589bc8241f93}{reset}}(\mbox{\hyperlink{structvital_1_1poly__int}{poly\_mask}}\ reset\_mask)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00096\ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classvital_1_1_phaser_filter_a72202ae4a58d1e6545919da039319da3}{hardReset}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00102\ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classvital_1_1_phaser_filter_a8875cffdb8dbfbd230418f3f102ebb1e}{setClean}}(\textcolor{keywordtype}{bool}\ clean)\ \{\ clean\_\ =\ clean;\ \}}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00108\ \ \ \ \ \ \ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}\ \mbox{\hyperlink{classvital_1_1_phaser_filter_a5d0023a5557d6d8ebfc2469a32215560}{getResonance}}()\ \{\ \textcolor{keywordflow}{return}\ resonance\_;\ \}}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00114\ \ \ \ \ \ \ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}\ \mbox{\hyperlink{classvital_1_1_phaser_filter_a486e6960b0a4594cda2adf0c3a7ad9e1}{getDrive}}()\ \{\ \textcolor{keywordflow}{return}\ drive\_;\ \}}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00120\ \ \ \ \ \ \ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}\ \mbox{\hyperlink{classvital_1_1_phaser_filter_a5ccd504dd0a698d644c5e629ae689844}{getPeak1Amount}}()\ \{\ \textcolor{keywordflow}{return}\ peak1\_amount\_;\ \}}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00126\ \ \ \ \ \ \ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}\ \mbox{\hyperlink{classvital_1_1_phaser_filter_a6e241b7ab4c314f4f2fb30109d1600b4}{getPeak3Amount}}()\ \{\ \textcolor{keywordflow}{return}\ peak3\_amount\_;\ \}}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00132\ \ \ \ \ \ \ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}\ \mbox{\hyperlink{classvital_1_1_phaser_filter_aab45a5bc6da6a1894b28a6d5107eaa27}{getPeak5Amount}}()\ \{\ \textcolor{keywordflow}{return}\ peak5\_amount\_;\ \}}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \textcolor{keyword}{template}\ <poly\_\textcolor{keywordtype}{float}(*saturateResonance)(poly\_\textcolor{keywordtype}{float}),\ poly\_\textcolor{keywordtype}{float}(*saturateInput)(poly\_\textcolor{keywordtype}{float})>}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classvital_1_1_phaser_filter_a85b5bed3cbe0d38ca4239e69f327f2e1}{process}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}*\ audio\_in,\ \textcolor{keywordtype}{int}\ num\_samples)\ \{}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Cache\ current\ parameters}}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}\ current\_resonance\ =\ resonance\_;}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}\ current\_drive\ =\ drive\_;}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}\ current\_peak1\ =\ peak1\_amount\_;}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}\ current\_peak3\ =\ peak3\_amount\_;}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}\ current\_peak5\ =\ peak5\_amount\_;}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Reload\ FilterState\ settings\ (in\ case\ they\ changed)}}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classvital_1_1_synth_filter_a4374a6bd751513a8236c468e184d67c1}{filter\_state\_}}.\mbox{\hyperlink{classvital_1_1_synth_filter_1_1_filter_state_a238e3fe5c0d0e24d92e3cd443f5191c9}{loadSettings}}(\textcolor{keyword}{this});}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classvital_1_1_phaser_filter_aba06b911834108f8cbe312bcf4838aa9}{setupFilter}}(\mbox{\hyperlink{classvital_1_1_synth_filter_a4374a6bd751513a8236c468e184d67c1}{filter\_state\_}});}
\DoxyCodeLine{00157\ }
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ for\ resets}}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvital_1_1poly__int}{poly\_mask}}\ reset\_mask\ =\ \mbox{\hyperlink{classvital_1_1_processor_a7fed5dc3ae95e104c71f7ce7f570fab4}{getResetMask}}(\mbox{\hyperlink{classvital_1_1_synth_filter_a03c515d2b209852494e96aaf3ecd1fa0a5ae1d17d40ed0b23e2c2fa01a0620c05}{kReset}});}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (reset\_mask.\mbox{\hyperlink{structvital_1_1poly__int_a2fab54be2efa9a05ed842b91e4bad62d}{anyMask}}())\ \{}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classvital_1_1_phaser_filter_a55f5c526881e1dff88d7589bc8241f93}{reset}}(reset\_mask);}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \ \ current\_resonance\ =\ \mbox{\hyperlink{namespacevital_1_1utils_ace9619cc7eac91b3abdcd77011b1ecb3}{utils::maskLoad}}(current\_resonance,\ resonance\_,\ reset\_mask);}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \ \ current\_drive\ =\ \mbox{\hyperlink{namespacevital_1_1utils_ace9619cc7eac91b3abdcd77011b1ecb3}{utils::maskLoad}}(current\_drive,\ drive\_,\ reset\_mask);}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \ \ current\_peak1\ =\ \mbox{\hyperlink{namespacevital_1_1utils_ace9619cc7eac91b3abdcd77011b1ecb3}{utils::maskLoad}}(current\_peak1,\ peak1\_amount\_,\ reset\_mask);}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \ \ current\_peak3\ =\ \mbox{\hyperlink{namespacevital_1_1utils_ace9619cc7eac91b3abdcd77011b1ecb3}{utils::maskLoad}}(current\_peak3,\ peak3\_amount\_,\ reset\_mask);}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \ \ current\_peak5\ =\ \mbox{\hyperlink{namespacevital_1_1utils_ace9619cc7eac91b3abdcd77011b1ecb3}{utils::maskLoad}}(current\_peak5,\ peak5\_amount\_,\ reset\_mask);}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ per-\/sample\ increments\ for\ parameter\ smoothing}}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacevital_afcc17475a10ef776bbd2f11b64c1ddfb}{mono\_float}}\ tick\_increment\ =\ 1.0f\ /\ num\_samples;}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ poly\_float\ delta\_resonance\ =\ (resonance\_\ -\/\ current\_resonance)\ *\ tick\_increment;}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ poly\_float\ delta\_drive\ =\ (drive\_\ -\/\ current\_drive)\ *\ tick\_increment;}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ poly\_float\ delta\_peak1\ =\ (peak1\_amount\_\ -\/\ current\_peak1)\ *\ tick\_increment;}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ poly\_float\ delta\_peak3\ =\ (peak3\_amount\_\ -\/\ current\_peak3)\ *\ tick\_increment;}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ poly\_float\ delta\_peak5\ =\ (peak5\_amount\_\ -\/\ current\_peak5)\ *\ tick\_increment;}
\DoxyCodeLine{00177\ }
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ poly\_float*\ audio\_out\ =\ \mbox{\hyperlink{classvital_1_1_processor_ab09651265a7270548b77e99b1316fde0}{output}}()-\/>\mbox{\hyperlink{structvital_1_1_output_a1bc2c3a75ee0525ecbfb24fc841b1fe4}{buffer}};}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classvital_1_1_synth_filter_abc8428d43d1fde33eba11801f8b3d559}{CoefficientLookup}}*\ coefficient\_lookup\ =\ \mbox{\hyperlink{classvital_1_1_synth_filter_a68d8089bf149c42e809924d6a6ecf4b8}{getCoefficientLookup}}();}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ poly\_float*\ midi\_cutoff\_buffer\ =\ \mbox{\hyperlink{classvital_1_1_synth_filter_a4374a6bd751513a8236c468e184d67c1}{filter\_state\_}}.\mbox{\hyperlink{classvital_1_1_synth_filter_1_1_filter_state_a2931c98e0bdbcb4b8b8c5a3838fd7b51}{midi\_cutoff\_buffer}};}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ poly\_float\ base\_midi\ =\ midi\_cutoff\_buffer[num\_samples\ -\/\ 1];}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ poly\_float\ base\_frequency\ =\ \mbox{\hyperlink{namespacevital_1_1utils_ad576b73366d625ca0b47c8b92b81f7a4}{utils::midiNoteToFrequency}}(base\_midi)\ *\ (1.0f\ /\ \mbox{\hyperlink{classvital_1_1_processor_a70822ba483c1a6528f1809621befd4b8}{getSampleRate}}());}
\DoxyCodeLine{00183\ }
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Process\ each\ sample}}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_samples;\ ++i)\ \{}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \ \ poly\_float\ midi\_delta\ =\ midi\_cutoff\_buffer[i]\ -\/\ base\_midi;}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \ \ poly\_float\ frequency\ =\ \mbox{\hyperlink{namespacevital_1_1utils_a5b6ee09220fec012fc1597235e4c50e3}{utils::min}}(base\_frequency\ *\ \mbox{\hyperlink{namespacevital_1_1futils_aa35d2367143c749fae5760f3663d2e96}{futils::midiOffsetToRatio}}(midi\_delta),\ 1.0f);}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \ \ poly\_float\ coefficient\ =\ coefficient\_lookup-\/>cubicLookup(frequency);}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Smoothly\ update\ parameters}}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \ \ current\_resonance\ +=\ delta\_resonance;}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \ \ current\_drive\ +=\ delta\_drive;}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \ \ current\_peak1\ +=\ delta\_peak1;}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \ \ current\_peak3\ +=\ delta\_peak3;}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \ \ current\_peak5\ +=\ delta\_peak5;}
\DoxyCodeLine{00196\ }
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Process\ a\ single\ sample\ through\ phaser\ stages}}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \ \ tick<saturateResonance,\ saturateInput>(audio\_in[i],\ coefficient,}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ current\_resonance,\ current\_drive,}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ current\_peak1,\ current\_peak3,\ current\_peak5);}
\DoxyCodeLine{00201\ }
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ phaser\ output\ is\ a\ blend\ of\ the\ allpass\ output\ and\ the\ original\ signal}}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \ \ audio\_out[i]\ =\ (audio\_in[i]\ +\ invert\_mult\_\ *\ allpass\_output\_)\ *\ 0.5f;}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00206\ }
\DoxyCodeLine{00220\ \ \ \ \ \ \ \textcolor{keyword}{template}\ <poly\_\textcolor{keywordtype}{float}(*saturateResonance)(poly\_\textcolor{keywordtype}{float}),\ poly\_\textcolor{keywordtype}{float}(*saturateInput)(poly\_\textcolor{keywordtype}{float})>}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \mbox{\hyperlink{common_8h_ae8c57c7218a376f10cbdf0e50f1189ee}{force\_inline}}\ \textcolor{keywordtype}{void}\ tick(poly\_float\ audio\_in,\ poly\_float\ coefficient,}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ poly\_float\ \mbox{\hyperlink{formant__filter_8cpp_a763370db72febfa675aff8c7645edb85}{resonance}},\ poly\_float\ drive,}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ poly\_float\ peak1,\ poly\_float\ peak3,\ poly\_float\ peak5)\ \{}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Remove\ some\ lows,\ remove\ some\ highs}}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ poly\_float\ filter\_state\_lows\ =\ remove\_lows\_stage\_.\mbox{\hyperlink{classvital_1_1_one_pole_filter_ad14c30acf8f8cb5122e352652d852b5e}{tickBasic}}(allpass\_output\_,}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacevital_1_1utils_a5b6ee09220fec012fc1597235e4c50e3}{utils::min}}(coefficient\ *\ \mbox{\hyperlink{classvital_1_1_phaser_filter_a2d232d23563d637e854de3409785b3af}{kClearRatio}},\ 0.9f));}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ poly\_float\ filter\_state\_highs\ =\ remove\_highs\_stage\_.\mbox{\hyperlink{classvital_1_1_one_pole_filter_ad14c30acf8f8cb5122e352652d852b5e}{tickBasic}}(filter\_state\_lows,}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ coefficient\ *\ (1.0f\ /\ \mbox{\hyperlink{classvital_1_1_phaser_filter_a2d232d23563d637e854de3409785b3af}{kClearRatio}}));}
\DoxyCodeLine{00229\ }
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Saturate\ resonance\ feedback}}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ poly\_float\ filter\_state\ =\ saturateResonance(\mbox{\hyperlink{formant__filter_8cpp_a763370db72febfa675aff8c7645edb85}{resonance}}\ *\ (filter\_state\_lows\ -\/\ filter\_state\_highs));}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Combine\ input\ with\ negative\ feedback}}
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ poly\_float\ filter\_input\ =\ \mbox{\hyperlink{namespacevital_1_1utils_a35863713535365219778ac997a789cf3}{utils::mulAdd}}(drive\ *\ audio\_in,\ invert\_mult\_,\ filter\_state);}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \ \ poly\_float\ all\_pass\_input\ =\ saturateInput(filter\_input);}
\DoxyCodeLine{00236\ }
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Pass\ through\ kPeakStage\ (4)\ all-\/pass\ stages\ for\ peak\ 1}}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ poly\_float\ stage\_out;}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{classvital_1_1_phaser_filter_a53fc113b82db4dd79258f170c353fcf0}{kPeakStage}};\ ++i)\ \{}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \ \ stage\_out\ =\ stages\_[i].\mbox{\hyperlink{classvital_1_1_one_pole_filter_ad14c30acf8f8cb5122e352652d852b5e}{tickBasic}}(all\_pass\_input,\ coefficient);}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \ \ all\_pass\_input\ =\ \mbox{\hyperlink{namespacevital_1_1utils_a35863713535365219778ac997a789cf3}{utils::mulAdd}}(all\_pass\_input,\ stage\_out,\ -\/2.0f);}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ poly\_float\ peak1\_out\ =\ all\_pass\_input;}
\DoxyCodeLine{00244\ }
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Next\ kPeakStage\ all-\/pass\ stages\ for\ peak\ 3}}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ \mbox{\hyperlink{classvital_1_1_phaser_filter_a53fc113b82db4dd79258f170c353fcf0}{kPeakStage}};\ i\ <\ 2\ *\ \mbox{\hyperlink{classvital_1_1_phaser_filter_a53fc113b82db4dd79258f170c353fcf0}{kPeakStage}};\ ++i)\ \{}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \ \ stage\_out\ =\ stages\_[i].\mbox{\hyperlink{classvital_1_1_one_pole_filter_ad14c30acf8f8cb5122e352652d852b5e}{tickBasic}}(all\_pass\_input,\ coefficient);}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \ \ all\_pass\_input\ =\ \mbox{\hyperlink{namespacevital_1_1utils_a35863713535365219778ac997a789cf3}{utils::mulAdd}}(all\_pass\_input,\ stage\_out,\ -\/2.0f);}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ poly\_float\ peak3\_out\ =\ all\_pass\_input;}
\DoxyCodeLine{00251\ }
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Final\ kPeakStage\ all-\/pass\ stages\ for\ peak\ 5}}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 2\ *\ \mbox{\hyperlink{classvital_1_1_phaser_filter_a53fc113b82db4dd79258f170c353fcf0}{kPeakStage}};\ i\ <\ 3\ *\ \mbox{\hyperlink{classvital_1_1_phaser_filter_a53fc113b82db4dd79258f170c353fcf0}{kPeakStage}};\ ++i)\ \{}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \ \ stage\_out\ =\ stages\_[i].\mbox{\hyperlink{classvital_1_1_one_pole_filter_ad14c30acf8f8cb5122e352652d852b5e}{tickBasic}}(all\_pass\_input,\ coefficient);}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \ \ all\_pass\_input\ =\ \mbox{\hyperlink{namespacevital_1_1utils_a35863713535365219778ac997a789cf3}{utils::mulAdd}}(all\_pass\_input,\ stage\_out,\ -\/2.0f);}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ poly\_float\ peak5\_out\ =\ all\_pass\_input;}
\DoxyCodeLine{00258\ }
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Combine\ the\ outputs\ of\ each\ peak\ cluster}}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \ \ poly\_float\ all\_pass\_output\_1\_3\ =\ \mbox{\hyperlink{namespacevital_1_1utils_a35863713535365219778ac997a789cf3}{utils::mulAdd}}(peak1\ *\ peak1\_out,\ peak3,\ peak3\_out);}
\DoxyCodeLine{00261\ \ \ \ \ \ \ \ \ allpass\_output\_\ =\ \mbox{\hyperlink{namespacevital_1_1utils_a35863713535365219778ac997a789cf3}{utils::mulAdd}}(all\_pass\_output\_1\_3,\ peak5,\ peak5\_out);}
\DoxyCodeLine{00262\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00263\ }
\DoxyCodeLine{00267\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ clean\_;}
\DoxyCodeLine{00268\ }
\DoxyCodeLine{00272\ \ \ \ \ \ \ poly\_float\ resonance\_;}
\DoxyCodeLine{00273\ }
\DoxyCodeLine{00277\ \ \ \ \ \ \ poly\_float\ drive\_;}
\DoxyCodeLine{00278\ }
\DoxyCodeLine{00282\ \ \ \ \ \ \ poly\_float\ peak1\_amount\_;}
\DoxyCodeLine{00283\ }
\DoxyCodeLine{00287\ \ \ \ \ \ \ poly\_float\ peak3\_amount\_;}
\DoxyCodeLine{00288\ }
\DoxyCodeLine{00292\ \ \ \ \ \ \ poly\_float\ peak5\_amount\_;}
\DoxyCodeLine{00293\ }
\DoxyCodeLine{00297\ \ \ \ \ \ \ poly\_float\ invert\_mult\_;}
\DoxyCodeLine{00298\ }
\DoxyCodeLine{00302\ \ \ \ \ \ \ OnePoleFilter<>\ stages\_[\mbox{\hyperlink{classvital_1_1_phaser_filter_a1aebd49d7f42fe99c4e6672d329c6ef0}{kMaxStages}}];}
\DoxyCodeLine{00303\ }
\DoxyCodeLine{00307\ \ \ \ \ \ \ OnePoleFilter<>\ remove\_lows\_stage\_;}
\DoxyCodeLine{00308\ \ \ \ \ \ \ OnePoleFilter<>\ remove\_highs\_stage\_;}
\DoxyCodeLine{00309\ }
\DoxyCodeLine{00313\ \ \ \ \ \ \ poly\_float\ allpass\_output\_;}
\DoxyCodeLine{00314\ }
\DoxyCodeLine{00315\ \ \ \ \ \ \ JUCE\_LEAK\_DETECTOR(\mbox{\hyperlink{classvital_1_1_phaser_filter_a04efb8e87fbb545f1ac5b799768b86d1}{PhaserFilter}})}
\DoxyCodeLine{00316\ \ \ \};}
\DoxyCodeLine{00317\ \}\ \textcolor{comment}{//\ namespace\ vital}}

\end{DoxyCode}
