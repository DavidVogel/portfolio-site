\doxysection{midi\+\_\+keyboard.\+cpp}
\hypertarget{midi__keyboard_8cpp_source}{}\label{midi__keyboard_8cpp_source}\index{/Users/davidvogel/repos/VitalHelp/src/interface/editor\_components/midi\_keyboard.cpp@{/Users/davidvogel/repos/VitalHelp/src/interface/editor\_components/midi\_keyboard.cpp}}
\mbox{\hyperlink{midi__keyboard_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{midi__keyboard_8h}{midi\_keyboard.h}}"{}}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{class_midi_keyboard_a000dc40832797857d62058651c1d5d29}{MidiKeyboard::kBlackKeyOffsets}}[kNumBlackKeysPerOctave]\ =\ \{}
\DoxyCodeLine{00004\ \ \ 1.0f\ -\/\ 0.6f\ *\ kBlackKeyWidthRatio,}
\DoxyCodeLine{00005\ \ \ 2.0f\ -\/\ 0.4f\ *\ kBlackKeyWidthRatio,}
\DoxyCodeLine{00006\ \ \ 4.0f\ -\/\ 0.7f\ *\ kBlackKeyWidthRatio,}
\DoxyCodeLine{00007\ \ \ 5.0f\ -\/\ 0.5f\ *\ kBlackKeyWidthRatio,}
\DoxyCodeLine{00008\ \ \ 6.0f\ -\/\ 0.3f\ *\ kBlackKeyWidthRatio,}
\DoxyCodeLine{00009\ \};}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_midi_keyboard_a478847efbbb004139214cb04b0b7448e}{MidiKeyboard::kWhiteKeys}}[\mbox{\hyperlink{namespacevital_a536eae8e1b7eab087dc163b9911bca6e}{vital::kNotesPerOctave}}]\ =\ \{}
\DoxyCodeLine{00012\ \ \ \textcolor{keyword}{true},\ \textcolor{keyword}{false},\ \textcolor{keyword}{true},\ \textcolor{keyword}{false},\ \textcolor{keyword}{true},\ \textcolor{keyword}{true},\ \textcolor{keyword}{false},\ \textcolor{keyword}{true},\ \textcolor{keyword}{false},\ \textcolor{keyword}{true},\ \textcolor{keyword}{false},\ \textcolor{keyword}{true}}
\DoxyCodeLine{00013\ \};}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \textcolor{keyword}{namespace\ }\{}
\DoxyCodeLine{00016\ \ \ \textcolor{keywordtype}{int}\ getBlackKeyOctaveOffset(\textcolor{keywordtype}{int}\ black\_key\_index)\ \{}
\DoxyCodeLine{00017\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{namespacevital_a536eae8e1b7eab087dc163b9911bca6e}{vital::kNotesPerOctave}};\ ++i)\ \{}
\DoxyCodeLine{00018\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{class_midi_keyboard_a478847efbbb004139214cb04b0b7448e}{MidiKeyboard::kWhiteKeys}}[i])\ \{}
\DoxyCodeLine{00019\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (black\_key\_index\ ==\ 0)}
\DoxyCodeLine{00020\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ i;}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \ \ \ \ \ \ \ \ black\_key\_index-\/-\/;}
\DoxyCodeLine{00023\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00024\ \ \ \ \ \}}
\DoxyCodeLine{00025\ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00026\ \ \ \}}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \ \ \textcolor{keywordtype}{int}\ getWhiteKeyOctaveOffset(\textcolor{keywordtype}{int}\ white\_key\_index)\ \{}
\DoxyCodeLine{00029\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{namespacevital_a536eae8e1b7eab087dc163b9911bca6e}{vital::kNotesPerOctave}};\ ++i)\ \{}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{class_midi_keyboard_a478847efbbb004139214cb04b0b7448e}{MidiKeyboard::kWhiteKeys}}[i])\ \{}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (white\_key\_index\ ==\ 0)}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ i;}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ white\_key\_index-\/-\/;}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00036\ \ \ \ \ \}}
\DoxyCodeLine{00037\ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00038\ \ \ \}}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \ \ \textcolor{keywordtype}{int}\ getBlackKeyIndexFromOffset(\textcolor{keywordtype}{int}\ note\_offset)\ \{}
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{keywordtype}{int}\ black\_key\_index\ =\ 0;}
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ note\_offset;\ ++i)\ \{}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{class_midi_keyboard_a478847efbbb004139214cb04b0b7448e}{MidiKeyboard::kWhiteKeys}}[i])}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ black\_key\_index++;}
\DoxyCodeLine{00045\ \ \ \ \ \}}
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keywordflow}{return}\ black\_key\_index;}
\DoxyCodeLine{00047\ \ \ \}}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \ \ \textcolor{keywordtype}{int}\ getWhiteKeyIndexFromOffset(\textcolor{keywordtype}{int}\ note\_offset)\ \{}
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{keywordtype}{int}\ white\_key\_index\ =\ 0;}
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ note\_offset;\ ++i)\ \{}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{class_midi_keyboard_a478847efbbb004139214cb04b0b7448e}{MidiKeyboard::kWhiteKeys}}[i])}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ white\_key\_index++;}
\DoxyCodeLine{00054\ \ \ \ \ \}}
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{keywordflow}{return}\ white\_key\_index;}
\DoxyCodeLine{00056\ \ \ \}}
\DoxyCodeLine{00057\ \}}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \mbox{\hyperlink{class_midi_keyboard_afad0cec69321d53135a985a07b940539}{MidiKeyboard::MidiKeyboard}}(MidiKeyboardState\&\ state)\ :}
\DoxyCodeLine{00060\ \ \ \ \ \mbox{\hyperlink{class_open_gl_component}{OpenGlComponent}}(\textcolor{stringliteral}{"{}keyboard"{}}),\ state\_(state),\ midi\_channel\_(1),\ hover\_note\_(-\/1),}
\DoxyCodeLine{00061\ \ \ \ \ black\_notes\_(kNumBlackKeys,\ \mbox{\hyperlink{class_shaders}{Shaders}}::kRoundedRectangleFragment),}
\DoxyCodeLine{00062\ \ \ \ \ white\_pressed\_notes\_(kNumWhiteKeys,\ \mbox{\hyperlink{class_shaders}{Shaders}}::kRoundedRectangleFragment),}
\DoxyCodeLine{00063\ \ \ \ \ black\_pressed\_notes\_(kNumBlackKeys,\ \mbox{\hyperlink{class_shaders}{Shaders}}::kRoundedRectangleFragment),}
\DoxyCodeLine{00064\ \ \ \ \ hover\_note\_quad\_(\mbox{\hyperlink{class_shaders}{Shaders}}::kRoundedRectangleFragment)\ \{}
\DoxyCodeLine{00065\ \ \ black\_notes\_.\mbox{\hyperlink{class_open_gl_multi_quad_a400b44f0d176e32e9a3014be91816808}{setTargetComponent}}(\textcolor{keyword}{this});}
\DoxyCodeLine{00066\ \ \ white\_pressed\_notes\_.\mbox{\hyperlink{class_open_gl_multi_quad_a400b44f0d176e32e9a3014be91816808}{setTargetComponent}}(\textcolor{keyword}{this});}
\DoxyCodeLine{00067\ \ \ black\_pressed\_notes\_.\mbox{\hyperlink{class_open_gl_multi_quad_a400b44f0d176e32e9a3014be91816808}{setTargetComponent}}(\textcolor{keyword}{this});}
\DoxyCodeLine{00068\ \ \ hover\_note\_quad\_.\mbox{\hyperlink{class_open_gl_multi_quad_a400b44f0d176e32e9a3014be91816808}{setTargetComponent}}(\textcolor{keyword}{this});}
\DoxyCodeLine{00069\ \ \ hover\_note\_quad\_.\mbox{\hyperlink{class_open_gl_multi_quad_a35c108ca44accfef5055ac8df84a579d}{setQuad}}(0,\ -\/2.0f,\ -\/2.0f,\ 0.0f,\ 0.0f);}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ \textcolor{keywordtype}{int}\ num\_children\ =\ getNumChildComponents();}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_children;\ ++i)\ \{}
\DoxyCodeLine{00074\ \ \ \ \ Component*\ child\ =\ getChildComponent(i);}
\DoxyCodeLine{00075\ \ \ \ \ child-\/>setWantsKeyboardFocus(\textcolor{keyword}{false});}
\DoxyCodeLine{00076\ \ \ \}}
\DoxyCodeLine{00077\ \}}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_midi_keyboard_a5702b549682f3fa0c3c51ad8c5401ed4}{MidiKeyboard::paintBackground}}(Graphics\&\ g)\ \{}
\DoxyCodeLine{00080\ \ \ \textcolor{keywordtype}{float}\ width\ =\ getWidth();}
\DoxyCodeLine{00081\ \ \ \textcolor{keywordtype}{int}\ height\ =\ getHeight();}
\DoxyCodeLine{00082\ \ \ g.setColour(black\_key\_color\_);}
\DoxyCodeLine{00083\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 1;\ i\ <\ \mbox{\hyperlink{class_midi_keyboard_a98299ed197fa5a38070ef82130477bb6}{kNumWhiteKeys}};\ ++i)\ \{}
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{keywordtype}{int}\ x\ =\ i\ *\ width\ /\ \mbox{\hyperlink{class_midi_keyboard_a98299ed197fa5a38070ef82130477bb6}{kNumWhiteKeys}};}
\DoxyCodeLine{00085\ \ \ \ \ g.fillRect(x,\ 0,\ 1,\ height);}
\DoxyCodeLine{00086\ \ \ \}}
\DoxyCodeLine{00087\ \}}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_midi_keyboard_a0baef1c11feab99810d37689e7207fcb}{MidiKeyboard::parentHierarchyChanged}}()\ \{}
\DoxyCodeLine{00090\ \ \ \mbox{\hyperlink{class_midi_keyboard_a9cf8ed1068c679850ecd6aa0f29042e2}{setColors}}();}
\DoxyCodeLine{00091\ \}}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_midi_keyboard_a9cf8ed1068c679850ecd6aa0f29042e2}{MidiKeyboard::setColors}}()\ \{}
\DoxyCodeLine{00094\ \ \ \textcolor{keywordflow}{if}\ (findParentComponentOfClass<SynthGuiInterface>()\ ==\ \textcolor{keyword}{nullptr})}
\DoxyCodeLine{00095\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \ \ key\_press\_color\_\ =\ findColour(\mbox{\hyperlink{class_skin_a7dc2a5a0b040e6ca38c7e5c236b4127ca57224e1a8b8454d64ee7092f63b89420}{Skin::kWidgetPrimary1}},\ \textcolor{keyword}{true});}
\DoxyCodeLine{00098\ \ \ hover\_color\_\ =\ findColour(\mbox{\hyperlink{class_skin_a7dc2a5a0b040e6ca38c7e5c236b4127caf911444fc8e39321d57b23c144a5f3d5}{Skin::kWidgetAccent2}},\ \textcolor{keyword}{true});}
\DoxyCodeLine{00099\ \ \ white\_key\_color\_\ =\ findColour(\mbox{\hyperlink{class_skin_a7dc2a5a0b040e6ca38c7e5c236b4127ca759c8acbffc8962e9ee2d8cba9677e73}{Skin::kWidgetSecondary1}},\ \textcolor{keyword}{true});}
\DoxyCodeLine{00100\ \ \ black\_key\_color\_\ =\ findColour(\mbox{\hyperlink{class_skin_a7dc2a5a0b040e6ca38c7e5c236b4127caf0e70a44ed7ab9d5dbef16a856b50cfb}{Skin::kWidgetSecondary2}},\ \textcolor{keyword}{true});}
\DoxyCodeLine{00101\ \}}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_midi_keyboard_ab49fc360173e6d3fe400894abff11899}{MidiKeyboard::resized}}()\ \{}
\DoxyCodeLine{00104\ \ \ \mbox{\hyperlink{class_open_gl_component_a2bd142dbb0cb7690829cb0a99f84e993}{OpenGlComponent::resized}}();}
\DoxyCodeLine{00105\ \ \ \mbox{\hyperlink{class_midi_keyboard_a9cf8ed1068c679850ecd6aa0f29042e2}{setColors}}();}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \ \ \textcolor{keywordtype}{float}\ width\ =\ getWidth();}
\DoxyCodeLine{00108\ \ \ \textcolor{keywordtype}{float}\ height\ =\ getHeight();}
\DoxyCodeLine{00109\ \ \ \textcolor{keywordtype}{float}\ black\_key\_height\ =\ 2.0f\ *\ ((int)(height\ *\ \mbox{\hyperlink{class_midi_keyboard_ad1cb37d31bd235c0c04a9fd17d5c2e89}{kBlackKeyHeightRatio}}))\ /\ height;}
\DoxyCodeLine{00110\ \ \ \textcolor{keywordtype}{float}\ black\_key\_y\ =\ 1.0f\ -\/\ black\_key\_height;}
\DoxyCodeLine{00111\ \ \ \textcolor{keywordtype}{float}\ white\_key\_width\ =\ 2.0f\ /\ \mbox{\hyperlink{class_midi_keyboard_a98299ed197fa5a38070ef82130477bb6}{kNumWhiteKeys}};}
\DoxyCodeLine{00112\ \ \ \textcolor{keywordtype}{float}\ black\_key\_width\ =\ (((int)(\mbox{\hyperlink{class_midi_keyboard_ad07e4cb437535d56a4fae7dc3329343c}{kBlackKeyWidthRatio}}\ *\ white\_key\_width\ *\ width\ /\ 4.0f))\ *\ 4.0f\ +\ 2.0f)\ /\ width;}
\DoxyCodeLine{00113\ \ \ \textcolor{keywordtype}{float}\ octave\_width\ =\ \mbox{\hyperlink{class_midi_keyboard_ab8dc3d66469e4891ebba3eccf50d7289}{kNumWhiteKeysPerOctave}}\ *\ white\_key\_width;}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{class_midi_keyboard_ae94957be3b47b58fd19e31dcda6deeb8}{kNumBlackKeys}};\ ++i)\ \{}
\DoxyCodeLine{00116\ \ \ \ \ \textcolor{keywordtype}{int}\ octave\ =\ i\ /\ \mbox{\hyperlink{class_midi_keyboard_a2caf247609329e686a0c23f5b67115d5}{kNumBlackKeysPerOctave}};}
\DoxyCodeLine{00117\ \ \ \ \ \textcolor{keywordtype}{int}\ index\ =\ i\ \%\ \mbox{\hyperlink{class_midi_keyboard_a2caf247609329e686a0c23f5b67115d5}{kNumBlackKeysPerOctave}};}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{keywordtype}{float}\ x\ =\ -\/1.0f\ +\ octave\_width\ *\ octave\ +\ \mbox{\hyperlink{class_midi_keyboard_a000dc40832797857d62058651c1d5d29}{kBlackKeyOffsets}}[index]\ *\ white\_key\_width;}
\DoxyCodeLine{00120\ \ \ \ \ x\ =\ ((int)((x\ +\ 1.0f)\ *\ width\ /\ 2.0f))\ *\ 2.0f\ /\ width\ -\/\ 1.0f;}
\DoxyCodeLine{00121\ \ \ \ \ black\_notes\_.\mbox{\hyperlink{class_open_gl_multi_quad_a35c108ca44accfef5055ac8df84a579d}{setQuad}}(i,\ x,\ black\_key\_y,\ black\_key\_width,\ black\_key\_height\ +\ 0.5f);}
\DoxyCodeLine{00122\ \ \ \}}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \ \ \textcolor{keywordtype}{float}\ widget\_rounding\ =\ \mbox{\hyperlink{class_open_gl_component_aabfea74619ee336cb31ea174c56d2c67}{findValue}}(\mbox{\hyperlink{class_skin_a65ea929118e660a168d02af741c29180ab3cb761113ca34ffe06c8ed64a7df2f1}{Skin::kWidgetRoundedCorner}});}
\DoxyCodeLine{00125\ \ \ black\_notes\_.\mbox{\hyperlink{class_open_gl_multi_quad_aba2d4bbfa5b4c1e4b510bc5746a221b6}{setRounding}}(widget\_rounding);}
\DoxyCodeLine{00126\ \ \ hover\_note\_quad\_.\mbox{\hyperlink{class_open_gl_multi_quad_aba2d4bbfa5b4c1e4b510bc5746a221b6}{setRounding}}(widget\_rounding);}
\DoxyCodeLine{00127\ \ \ black\_pressed\_notes\_.\mbox{\hyperlink{class_open_gl_multi_quad_aba2d4bbfa5b4c1e4b510bc5746a221b6}{setRounding}}(widget\_rounding);}
\DoxyCodeLine{00128\ \}}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{class_midi_keyboard_a50760d67638d9feab76a11893063965f}{MidiKeyboard::getNoteAtPosition}}(Point<float>\ position)\ \{}
\DoxyCodeLine{00131\ \ \ \textcolor{keywordtype}{float}\ white\_key\_position\ =\ \mbox{\hyperlink{class_midi_keyboard_a98299ed197fa5a38070ef82130477bb6}{kNumWhiteKeys}}\ *\ position.x\ /\ getWidth();}
\DoxyCodeLine{00132\ \ \ \textcolor{keywordtype}{int}\ octave\ =\ white\_key\_position\ /\ \mbox{\hyperlink{class_midi_keyboard_ab8dc3d66469e4891ebba3eccf50d7289}{kNumWhiteKeysPerOctave}};}
\DoxyCodeLine{00133\ \ \ \textcolor{keywordtype}{float}\ white\_key\_in\_octave\ =\ white\_key\_position\ -\/\ octave\ *\ \mbox{\hyperlink{class_midi_keyboard_ab8dc3d66469e4891ebba3eccf50d7289}{kNumWhiteKeysPerOctave}};}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \ \ \textcolor{comment}{//\ Check\ if\ click\ might\ be\ on\ a\ black\ key\ area\ first}}
\DoxyCodeLine{00136\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{class_midi_keyboard_ac43f007a6e0d1c9d05e8642d2263a9ee}{isBlackKeyHeight}}(position))\ \{}
\DoxyCodeLine{00137\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{class_midi_keyboard_a2caf247609329e686a0c23f5b67115d5}{kNumBlackKeysPerOctave}};\ ++i)\ \{}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ note\_offset\ =\ white\_key\_in\_octave\ -\/\ \mbox{\hyperlink{class_midi_keyboard_a000dc40832797857d62058651c1d5d29}{kBlackKeyOffsets}}[i];}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (note\_offset\ <=\ kBlackKeyWidthRatio\ \&\&\ note\_offset\ >=\ 0.0f)\ \{}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ note\ =\ octave\ *\ \mbox{\hyperlink{namespacevital_a536eae8e1b7eab087dc163b9911bca6e}{vital::kNotesPerOctave}}\ +\ getBlackKeyOctaveOffset(i);}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::min(\mbox{\hyperlink{namespacevital_a7be9efa423f42230b10924b0f69b3b03}{vital::kMidiSize}}\ -\/\ 1,\ std::max(note,\ 0));}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00143\ \ \ \ \ \}}
\DoxyCodeLine{00144\ \ \ \}}
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00146\ \ \ \textcolor{comment}{//\ Otherwise\ determine\ which\ white\ key}}
\DoxyCodeLine{00147\ \ \ \textcolor{keywordtype}{int}\ white\_key\_index\ =\ std::min<int>(\mbox{\hyperlink{class_midi_keyboard_ab8dc3d66469e4891ebba3eccf50d7289}{kNumWhiteKeysPerOctave}}\ -\/\ 1,\ white\_key\_in\_octave);}
\DoxyCodeLine{00148\ \ \ \textcolor{keywordtype}{int}\ note\ =\ octave\ *\ \mbox{\hyperlink{namespacevital_a536eae8e1b7eab087dc163b9911bca6e}{vital::kNotesPerOctave}}\ +\ getWhiteKeyOctaveOffset(white\_key\_index);}
\DoxyCodeLine{00149\ \ \ \textcolor{keywordflow}{return}\ std::min(\mbox{\hyperlink{namespacevital_a7be9efa423f42230b10924b0f69b3b03}{vital::kMidiSize}}\ -\/\ 1,\ std::max(note,\ 0));}
\DoxyCodeLine{00150\ \}}
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00152\ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{class_midi_keyboard_a1c6a6a20658629cbf5b47d2f288d503a}{MidiKeyboard::getVelocityForNote}}(\textcolor{keywordtype}{int}\ midi,\ Point<float>\ position)\ \{}
\DoxyCodeLine{00153\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{float}\ kMinVelocity\ =\ 1.0f\ /\ (\mbox{\hyperlink{namespacevital_a7be9efa423f42230b10924b0f69b3b03}{vital::kMidiSize}}\ -\/\ 1);}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00155\ \ \ \textcolor{keywordtype}{float}\ velocity\ =\ position.y\ /\ getHeight();}
\DoxyCodeLine{00156\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{class_midi_keyboard_a55ad01200c219ec2cd2ac8efe7a9029b}{isWhiteKey}}(midi))}
\DoxyCodeLine{00157\ \ \ \ \ velocity\ =\ position.y\ /\ (\mbox{\hyperlink{class_midi_keyboard_ad1cb37d31bd235c0c04a9fd17d5c2e89}{kBlackKeyHeightRatio}}\ *\ getHeight());}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ \ \ \textcolor{keywordflow}{return}\ std::max(kMinVelocity,\ std::min(1.0f,\ velocity));}
\DoxyCodeLine{00160\ \}}
\DoxyCodeLine{00161\ }
\DoxyCodeLine{00162\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_midi_keyboard_acbdd1140f440905040e0f025110dcca6}{MidiKeyboard::render}}(\mbox{\hyperlink{struct_open_gl_wrapper}{OpenGlWrapper}}\&\ open\_gl,\ \textcolor{keywordtype}{bool}\ animate)\ \{}
\DoxyCodeLine{00163\ \ \ \mbox{\hyperlink{class_midi_keyboard_a9468fdea704933a98891e20e0b518c82}{setPressedKeyPositions}}();}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00165\ \ \ hover\_note\_quad\_.\mbox{\hyperlink{class_open_gl_multi_quad_a706334ae3e0b28b38b729132dea195e2}{setColor}}(hover\_color\_);}
\DoxyCodeLine{00166\ \ \ \textcolor{keywordtype}{int}\ hover\_note\ =\ hover\_note\_;}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00168\ \ \ \textcolor{comment}{//\ Draw\ hover\ key\ if\ any}}
\DoxyCodeLine{00169\ \ \ \textcolor{keywordflow}{if}\ (hover\_note\ >=\ 0)\ \{}
\DoxyCodeLine{00170\ \ \ \ \ \textcolor{keywordtype}{int}\ octave\ =\ hover\_note\ /\ \mbox{\hyperlink{namespacevital_a536eae8e1b7eab087dc163b9911bca6e}{vital::kNotesPerOctave}};}
\DoxyCodeLine{00171\ \ \ \ \ \textcolor{keywordtype}{int}\ note\_offset\ =\ hover\_note\ -\/\ octave\ *\ \mbox{\hyperlink{namespacevital_a536eae8e1b7eab087dc163b9911bca6e}{vital::kNotesPerOctave}};}
\DoxyCodeLine{00172\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{class_midi_keyboard_a55ad01200c219ec2cd2ac8efe7a9029b}{isWhiteKey}}(hover\_note))\ \{}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ index\ =\ octave\ *\ \mbox{\hyperlink{class_midi_keyboard_ab8dc3d66469e4891ebba3eccf50d7289}{kNumWhiteKeysPerOctave}}\ +\ getWhiteKeyIndexFromOffset(note\_offset);}
\DoxyCodeLine{00174\ \ \ \ \ \ \ setWhiteKeyQuad(\&hover\_note\_quad\_,\ 0,\ index);}
\DoxyCodeLine{00175\ \ \ \ \ \ \ hover\_note\_quad\_.\mbox{\hyperlink{class_open_gl_multi_quad_a4e30eb161abeeb1dbc07455fe390f8fa}{render}}(open\_gl,\ animate);}
\DoxyCodeLine{00176\ \ \ \ \ \}}
\DoxyCodeLine{00177\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ index\ =\ octave\ *\ \mbox{\hyperlink{class_midi_keyboard_a2caf247609329e686a0c23f5b67115d5}{kNumBlackKeysPerOctave}}\ +\ getBlackKeyIndexFromOffset(note\_offset);}
\DoxyCodeLine{00179\ \ \ \ \ \ \ setBlackKeyQuad(\&hover\_note\_quad\_,\ 0,\ index);}
\DoxyCodeLine{00180\ \ \ \ \ \}}
\DoxyCodeLine{00181\ \ \ \}}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00183\ \ \ white\_pressed\_notes\_.\mbox{\hyperlink{class_open_gl_multi_quad_a706334ae3e0b28b38b729132dea195e2}{setColor}}(key\_press\_color\_);}
\DoxyCodeLine{00184\ \ \ white\_pressed\_notes\_.\mbox{\hyperlink{class_open_gl_multi_quad_a4e30eb161abeeb1dbc07455fe390f8fa}{render}}(open\_gl,\ animate);}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ \ \ black\_notes\_.\mbox{\hyperlink{class_open_gl_multi_quad_a706334ae3e0b28b38b729132dea195e2}{setColor}}(black\_key\_color\_);}
\DoxyCodeLine{00187\ \ \ black\_notes\_.\mbox{\hyperlink{class_open_gl_multi_quad_a4e30eb161abeeb1dbc07455fe390f8fa}{render}}(open\_gl,\ animate);}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00189\ \ \ \textcolor{keywordflow}{if}\ (hover\_note\ >=\ 0\ \&\&\ !\mbox{\hyperlink{class_midi_keyboard_a55ad01200c219ec2cd2ac8efe7a9029b}{isWhiteKey}}(hover\_note))}
\DoxyCodeLine{00190\ \ \ \ \ hover\_note\_quad\_.\mbox{\hyperlink{class_open_gl_multi_quad_a4e30eb161abeeb1dbc07455fe390f8fa}{render}}(open\_gl,\ animate);}
\DoxyCodeLine{00191\ }
\DoxyCodeLine{00192\ \ \ black\_pressed\_notes\_.\mbox{\hyperlink{class_open_gl_multi_quad_a706334ae3e0b28b38b729132dea195e2}{setColor}}(key\_press\_color\_);}
\DoxyCodeLine{00193\ \ \ black\_pressed\_notes\_.\mbox{\hyperlink{class_open_gl_multi_quad_a4e30eb161abeeb1dbc07455fe390f8fa}{render}}(open\_gl,\ animate);}
\DoxyCodeLine{00194\ \}}
\DoxyCodeLine{00195\ }
\DoxyCodeLine{00196\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_midi_keyboard_a9468fdea704933a98891e20e0b518c82}{MidiKeyboard::setPressedKeyPositions}}()\ \{}
\DoxyCodeLine{00197\ \ \ \textcolor{keywordtype}{int}\ num\_pressed\_white\_keys\ =\ 0;}
\DoxyCodeLine{00198\ \ \ \textcolor{keywordtype}{int}\ num\_pressed\_black\_keys\ =\ 0;}
\DoxyCodeLine{00199\ \ \ \textcolor{keywordtype}{int}\ white\_key\_index\ =\ 0;}
\DoxyCodeLine{00200\ \ \ \textcolor{keywordtype}{int}\ black\_key\_index\ =\ 0;}
\DoxyCodeLine{00201\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{namespacevital_a7be9efa423f42230b10924b0f69b3b03}{vital::kMidiSize}};\ ++i)\ \{}
\DoxyCodeLine{00202\ \ \ \ \ \textcolor{keywordtype}{bool}\ white\_key\ =\ \mbox{\hyperlink{class_midi_keyboard_a55ad01200c219ec2cd2ac8efe7a9029b}{isWhiteKey}}(i);}
\DoxyCodeLine{00203\ \ \ \ \ \textcolor{keywordflow}{if}\ (state\_.isNoteOnForChannels(0xffff,\ i))\ \{}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (white\_key)\ \{}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ setWhiteKeyQuad(\&white\_pressed\_notes\_,\ num\_pressed\_white\_keys,\ white\_key\_index);}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ num\_pressed\_white\_keys++;}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ setBlackKeyQuad(\&black\_pressed\_notes\_,\ num\_pressed\_black\_keys,\ black\_key\_index);}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ num\_pressed\_black\_keys++;}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00212\ \ \ \ \ \}}
\DoxyCodeLine{00213\ }
\DoxyCodeLine{00214\ \ \ \ \ \textcolor{keywordflow}{if}\ (white\_key)}
\DoxyCodeLine{00215\ \ \ \ \ \ \ white\_key\_index++;}
\DoxyCodeLine{00216\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00217\ \ \ \ \ \ \ black\_key\_index++;}
\DoxyCodeLine{00218\ \ \ \}}
\DoxyCodeLine{00219\ }
\DoxyCodeLine{00220\ \ \ white\_pressed\_notes\_.\mbox{\hyperlink{class_open_gl_multi_quad_a4107db47ccf0c13befdb137e7e98cdfd}{setNumQuads}}(num\_pressed\_white\_keys);}
\DoxyCodeLine{00221\ \ \ black\_pressed\_notes\_.\mbox{\hyperlink{class_open_gl_multi_quad_a4107db47ccf0c13befdb137e7e98cdfd}{setNumQuads}}(num\_pressed\_black\_keys);}
\DoxyCodeLine{00222\ \}}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00224\ \textcolor{keywordtype}{void}\ MidiKeyboard::setWhiteKeyQuad(\mbox{\hyperlink{class_open_gl_multi_quad}{OpenGlMultiQuad}}*\ quads,\ \textcolor{keywordtype}{int}\ quad\_index,\ \textcolor{keywordtype}{int}\ white\_key\_index)\ \{}
\DoxyCodeLine{00225\ \ \ \textcolor{keywordtype}{float}\ full\_width\ =\ getWidth();}
\DoxyCodeLine{00226\ \ \ \textcolor{keywordtype}{int}\ start\_x\ =\ white\_key\_index\ *\ full\_width\ /\ \mbox{\hyperlink{class_midi_keyboard_a98299ed197fa5a38070ef82130477bb6}{kNumWhiteKeys}}\ +\ 1;}
\DoxyCodeLine{00227\ \ \ \textcolor{keywordtype}{int}\ end\_x\ =\ (white\_key\_index\ +\ 1)\ *\ full\_width\ /\ \mbox{\hyperlink{class_midi_keyboard_a98299ed197fa5a38070ef82130477bb6}{kNumWhiteKeys}};}
\DoxyCodeLine{00228\ \ \ \textcolor{keywordtype}{float}\ x\ =\ 2.0f\ *\ start\_x\ /\ full\_width\ -\/\ 1.0f;}
\DoxyCodeLine{00229\ \ \ \textcolor{keywordtype}{float}\ width\ =\ 2.0f\ *\ (end\_x\ -\/\ start\_x)\ /\ full\_width;}
\DoxyCodeLine{00230\ }
\DoxyCodeLine{00231\ \ \ quads-\/>\mbox{\hyperlink{class_open_gl_multi_quad_a35c108ca44accfef5055ac8df84a579d}{setQuad}}(quad\_index,\ x,\ -\/2.0f,\ width,\ 4.0f);}
\DoxyCodeLine{00232\ \}}
\DoxyCodeLine{00233\ }
\DoxyCodeLine{00234\ \textcolor{keywordtype}{void}\ MidiKeyboard::setBlackKeyQuad(\mbox{\hyperlink{class_open_gl_multi_quad}{OpenGlMultiQuad}}*\ quads,\ \textcolor{keywordtype}{int}\ quad\_index,\ \textcolor{keywordtype}{int}\ black\_key\_index)\ \{}
\DoxyCodeLine{00235\ \ \ \textcolor{keywordtype}{float}\ x\ =\ black\_notes\_.\mbox{\hyperlink{class_open_gl_multi_quad_ac63ee4a14e16b6fef6af3dbef3362f9a}{getQuadX}}(black\_key\_index);}
\DoxyCodeLine{00236\ \ \ \textcolor{keywordtype}{float}\ y\ =\ black\_notes\_.\mbox{\hyperlink{class_open_gl_multi_quad_ac1c67f8709303399c00ea1cba686a00e}{getQuadY}}(black\_key\_index);}
\DoxyCodeLine{00237\ \ \ \textcolor{keywordtype}{float}\ width\ =\ black\_notes\_.\mbox{\hyperlink{class_open_gl_multi_quad_a782376a7dc9bed691babb1527a2a517a}{getQuadWidth}}(black\_key\_index);}
\DoxyCodeLine{00238\ \ \ \textcolor{keywordtype}{float}\ height\ =\ black\_notes\_.\mbox{\hyperlink{class_open_gl_multi_quad_a3a65616636b55e936d8ca3074edfa1d0}{getQuadHeight}}(black\_key\_index);}
\DoxyCodeLine{00239\ \ \ \textcolor{keywordtype}{float}\ border\ =\ 2.0f\ /\ getWidth();}
\DoxyCodeLine{00240\ \ \ \textcolor{keywordtype}{float}\ y\_adjust\ =\ 2.0f\ /\ getHeight();}
\DoxyCodeLine{00241\ }
\DoxyCodeLine{00242\ \ \ quads-\/>\mbox{\hyperlink{class_open_gl_multi_quad_a35c108ca44accfef5055ac8df84a579d}{setQuad}}(quad\_index,\ x\ +\ border,\ y\ +\ y\_adjust,\ width\ -\/\ 2.0f\ *\ border,\ height);}
\DoxyCodeLine{00243\ \}}

\end{DoxyCode}
