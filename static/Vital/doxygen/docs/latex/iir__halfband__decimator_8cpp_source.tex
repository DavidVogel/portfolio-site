\doxysection{iir\+\_\+halfband\+\_\+decimator.\+cpp}
\hypertarget{iir__halfband__decimator_8cpp_source}{}\label{iir__halfband__decimator_8cpp_source}\index{/Users/davidvogel/repos/VitalHelp/src/synthesis/filters/iir\_halfband\_decimator.cpp@{/Users/davidvogel/repos/VitalHelp/src/synthesis/filters/iir\_halfband\_decimator.cpp}}
\mbox{\hyperlink{iir__halfband__decimator_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{iir__halfband__decimator_8h}{iir\_halfband\_decimator.h}}"{}}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacevital}{vital}}\ \{}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00010\ \ \ poly\_float\ \mbox{\hyperlink{classvital_1_1_iir_halfband_decimator_a35a7bb1557e4de3b7cc8cb9182c113f5}{IirHalfbandDecimator::kTaps9}}[kNumTaps9]\ =\ \{}
\DoxyCodeLine{00011\ \ \ \ \ \{\ 0.167135116548925f,\ 0.0413554705262319f\ \},}
\DoxyCodeLine{00012\ \ \ \ \ \{\ 0.742130012538075f,\ 0.3878932830211427f\ \},}
\DoxyCodeLine{00013\ \ \ \};}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00020\ \ \ poly\_float\ \mbox{\hyperlink{classvital_1_1_iir_halfband_decimator_a11ebd96e33767f3198abd4160616b9db}{IirHalfbandDecimator::kTaps25}}[kNumTaps25]\ =\ \{}
\DoxyCodeLine{00021\ \ \ \ \ \{\ 0.093022421467960f,\ 0.024388383731296f\ \},}
\DoxyCodeLine{00022\ \ \ \ \ \{\ 0.312318050871736f,\ 0.194029987625265f\ \},}
\DoxyCodeLine{00023\ \ \ \ \ \{\ 0.548379093159427f,\ 0.433855675727187f\ \},}
\DoxyCodeLine{00024\ \ \ \ \ \{\ 0.737198546150414f,\ 0.650124972769370f\ \},}
\DoxyCodeLine{00025\ \ \ \ \ \{\ 0.872234992057129f,\ 0.810418671775866f\ \},}
\DoxyCodeLine{00026\ \ \ \ \ \{\ 0.975497791832324f,\ 0.925979700943193f\ \}}
\DoxyCodeLine{00027\ \ \ \};}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00032\ \ \ \mbox{\hyperlink{classvital_1_1_iir_halfband_decimator_aa5274493d627bf297dd556cf168a8963}{IirHalfbandDecimator::IirHalfbandDecimator}}()}
\DoxyCodeLine{00033\ \ \ \ \ \ \ :\ \mbox{\hyperlink{classvital_1_1_processor}{Processor}}(kNumInputs,\ 1),\ sharp\_cutoff\_(false)\ \{}
\DoxyCodeLine{00034\ \ \ \ \ \mbox{\hyperlink{classvital_1_1_iir_halfband_decimator_af88e6e9a018a43a7bb24a5891c8cb3a4}{reset}}(\mbox{\hyperlink{namespacevital_1_1constants_a0ba15cafa5e21c3a54ff0e6208b860fa}{constants::kFullMask}});}
\DoxyCodeLine{00035\ \ \ \}}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00044\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classvital_1_1_iir_halfband_decimator_a0f15e145de633ce3b4aada03e57ac236}{IirHalfbandDecimator::process}}(\textcolor{keywordtype}{int}\ num\_samples)\ \{}
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_taps\ =\ \mbox{\hyperlink{classvital_1_1_iir_halfband_decimator_a0e63ec6c112615172613e00da9db7648}{kNumTaps9}};}
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}*\ taps\ =\ \mbox{\hyperlink{classvital_1_1_iir_halfband_decimator_a35a7bb1557e4de3b7cc8cb9182c113f5}{kTaps9}};}
\DoxyCodeLine{00047\ \ \ \ \ \textcolor{keywordflow}{if}\ (sharp\_cutoff\_)\ \{}
\DoxyCodeLine{00048\ \ \ \ \ \ \ num\_taps\ =\ \mbox{\hyperlink{classvital_1_1_iir_halfband_decimator_a63440c00d8b7d62ca8a41a1f16b60818}{kNumTaps25}};}
\DoxyCodeLine{00049\ \ \ \ \ \ \ taps\ =\ \mbox{\hyperlink{classvital_1_1_iir_halfband_decimator_a11ebd96e33767f3198abd4160616b9db}{kTaps25}};}
\DoxyCodeLine{00050\ \ \ \ \ \}}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}*\ audio\ =\ \mbox{\hyperlink{classvital_1_1_processor_a6785b9361f8b2fd7638c6a02483ec9eb}{input}}(\mbox{\hyperlink{classvital_1_1_iir_halfband_decimator_ac07c5857377dea0beef5c17ca59c798baeebf2dc7624e2255b3d127c5b7e29764}{kAudio}})-\/>\mbox{\hyperlink{structvital_1_1_input_adc691b9fd0f8c8c79c2a40e9e3314eaf}{source}}-\/>\mbox{\hyperlink{structvital_1_1_output_a1bc2c3a75ee0525ecbfb24fc841b1fe4}{buffer}};}
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{keywordtype}{int}\ output\_buffer\_size\ =\ num\_samples;}
\DoxyCodeLine{00054\ \ \ \ \ \mbox{\hyperlink{common_8h_ab6dc6a12600086762731fd406e501cf2}{VITAL\_ASSERT}}(\mbox{\hyperlink{classvital_1_1_processor_a6785b9361f8b2fd7638c6a02483ec9eb}{input}}(\mbox{\hyperlink{classvital_1_1_iir_halfband_decimator_ac07c5857377dea0beef5c17ca59c798baeebf2dc7624e2255b3d127c5b7e29764}{kAudio}})-\/>source-\/>buffer\_size\ >=\ 2\ *\ output\_buffer\_size);}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \ \ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}*\ audio\_out\ =\ \mbox{\hyperlink{classvital_1_1_processor_ab09651265a7270548b77e99b1316fde0}{output}}()-\/>\mbox{\hyperlink{structvital_1_1_output_a1bc2c3a75ee0525ecbfb24fc841b1fe4}{buffer}};}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{comment}{//\ Main\ loop:\ for\ each\ output\ sample,\ combine\ two\ input\ samples\ and\ update\ the\ delay\ lines}}
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ output\_buffer\_size;\ ++i)\ \{}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ audio\_in\_index\ =\ 2\ *\ i;}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \ \ \ \ \textcolor{comment}{//\ Consolidate\ two\ adjacent\ input\ samples\ into\ one\ poly\_float}}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}\ result\ =\ \mbox{\hyperlink{namespacevital_1_1utils_a1db075d94389e5c680770e9a5be70da2}{utils::consolidateAudio}}(audio[audio\_in\_index],}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ audio[audio\_in\_index\ +\ 1]);}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \ \ \ \ \ \ \textcolor{comment}{//\ Run\ through\ each\ tap\ in\ the\ IIR\ filter}}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ tap\_index\ =\ 0;\ tap\_index\ <\ num\_taps;\ ++tap\_index)\ \{}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Compute\ difference\ between\ current\ signal\ and\ stored\ output}}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}\ delta\ =\ result\ -\/\ out\_memory\_[tap\_index];}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Multiply-\/accumulate\ with\ the\ tap\ coefficient}}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}\ new\_result\ =\ \mbox{\hyperlink{namespacevital_1_1utils_a35863713535365219778ac997a789cf3}{utils::mulAdd}}(in\_memory\_[tap\_index],\ taps[tap\_index],\ delta);}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Update\ delay\ lines}}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ in\_memory\_[tap\_index]\ =\ result;}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ out\_memory\_[tap\_index]\ =\ new\_result;}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ filter\ output\ at\ this\ stage}}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ result\ =\ new\_result;}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \ \ \ \ \textcolor{comment}{//\ Sum\ the\ poly\_float\ lanes\ and\ scale\ by\ 0.5f}}
\DoxyCodeLine{00082\ \ \ \ \ \ \ audio\_out[i]\ =\ \mbox{\hyperlink{namespacevital_1_1utils_ac208f18bb6c575757e806be4458b6dfb}{utils::sumSplitAudio}}(result)\ *\ 0.5f;}
\DoxyCodeLine{00083\ \ \ \ \ \}}
\DoxyCodeLine{00084\ \ \ \}}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00092\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classvital_1_1_iir_halfband_decimator_af88e6e9a018a43a7bb24a5891c8cb3a4}{IirHalfbandDecimator::reset}}(\mbox{\hyperlink{structvital_1_1poly__int}{poly\_mask}}\ reset\_mask)\ \{}
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{classvital_1_1_iir_halfband_decimator_a63440c00d8b7d62ca8a41a1f16b60818}{kNumTaps25}};\ ++i)\ \{}
\DoxyCodeLine{00094\ \ \ \ \ \ \ in\_memory\_[i]\ =\ 0.0f;}
\DoxyCodeLine{00095\ \ \ \ \ \ \ out\_memory\_[i]\ =\ 0.0f;}
\DoxyCodeLine{00096\ \ \ \ \ \}}
\DoxyCodeLine{00097\ \ \ \}}
\DoxyCodeLine{00098\ \}\ \textcolor{comment}{//\ namespace\ vital}}

\end{DoxyCode}
