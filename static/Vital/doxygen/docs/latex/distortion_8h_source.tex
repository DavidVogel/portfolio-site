\doxysection{distortion.\+h}
\hypertarget{distortion_8h_source}{}\label{distortion_8h_source}\index{/Users/davidvogel/repos/VitalHelp/src/synthesis/effects/distortion.h@{/Users/davidvogel/repos/VitalHelp/src/synthesis/effects/distortion.h}}
\mbox{\hyperlink{distortion_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{processor_8h}{processor.h}}"{}}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{futils_8h}{futils.h}}"{}}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacevital}{vital}}\ \{}
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00016\ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classvital_1_1_distortion}{Distortion}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classvital_1_1_processor}{Processor}}\ \{}
\DoxyCodeLine{00017\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00021\ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \mbox{\hyperlink{namespacevital_afcc17475a10ef776bbd2f11b64c1ddfb}{mono\_float}}\ \mbox{\hyperlink{classvital_1_1_distortion_aed211fec0b904006b5d3c9ae731fe58a}{kMaxDrive}}\ =\ 30.0f;}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00026\ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \mbox{\hyperlink{namespacevital_afcc17475a10ef776bbd2f11b64c1ddfb}{mono\_float}}\ \mbox{\hyperlink{classvital_1_1_distortion_ad472bc3a67757613386b8ba90bf673a8}{kMinDrive}}\ =\ -\/30.0f;}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00031\ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{classvital_1_1_distortion_a6a162ad093cd1ee7eaa758256831ac1e}{kPeriodScale}}\ =\ 1.0f\ /\ 88200.0f;}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00036\ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \mbox{\hyperlink{namespacevital_afcc17475a10ef776bbd2f11b64c1ddfb}{mono\_float}}\ \mbox{\hyperlink{classvital_1_1_distortion_a65a6f3a0c1ff568722b507e013be3a84}{kMinDistortionMult}}\ =\ 32.0f\ /\ INT\_MAX;}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00042\ \ \ \ \ \ \ \textcolor{keyword}{enum}\ \{}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classvital_1_1_distortion_a2747ff2738120129d737495b281b9ddba02d18d63788c3dcca2e681fbab80c1ce}{kAudio}},\ }
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classvital_1_1_distortion_a2747ff2738120129d737495b281b9ddba67b828625c476e6394aefdaab60e8bcb}{kType}},\ \ }
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classvital_1_1_distortion_a2747ff2738120129d737495b281b9ddbaf5509109255eaa15fc6363b7ada45c39}{kDrive}},\ }
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classvital_1_1_distortion_a2747ff2738120129d737495b281b9ddbae8d71123027a07ea29da588dad2a8493}{kNumInputs}}}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \};}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00053\ \ \ \ \ \ \ \textcolor{keyword}{enum}\ \{}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classvital_1_1_distortion_a9b4adbb78786a7f47497eb75bb9d1dffa7c4570ab07048b46852161fcb835875d}{kAudioOut}},\ }
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classvital_1_1_distortion_a9b4adbb78786a7f47497eb75bb9d1dffa56d9d15e33dd5bf77c9848f6ae6f80bd}{kDriveOut}},\ }
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classvital_1_1_distortion_a9b4adbb78786a7f47497eb75bb9d1dffade1ac136d459568d2a647daa282fd88a}{kNumOutputs}}}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \};}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00063\ \ \ \ \ \ \ \textcolor{keyword}{enum}\ \mbox{\hyperlink{classvital_1_1_distortion_af511263ce9c679a9e98470c18464d4ee}{Type}}\ \{}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classvital_1_1_distortion_af511263ce9c679a9e98470c18464d4eea31bc8abb44ab6e0c12880f2cbc844f59}{kSoftClip}},\ \ \ \ }
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classvital_1_1_distortion_af511263ce9c679a9e98470c18464d4eea37ca89307424354e5a40e67dfa2fb374}{kHardClip}},\ \ \ \ }
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classvital_1_1_distortion_af511263ce9c679a9e98470c18464d4eea91c8333c35770477be26e9c89c665fae}{kLinearFold}},\ \ }
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classvital_1_1_distortion_af511263ce9c679a9e98470c18464d4eea1bc0c15ece89032a3652cb68f12b070c}{kSinFold}},\ \ \ \ \ }
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classvital_1_1_distortion_af511263ce9c679a9e98470c18464d4eead27279cfd28160a8a2575474eae32e91}{kBitCrush}},\ \ \ \ }
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classvital_1_1_distortion_af511263ce9c679a9e98470c18464d4eeadf0070fef6b2c11dd41d0a417535eae7}{kDownSample}},\ \ }
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classvital_1_1_distortion_af511263ce9c679a9e98470c18464d4eea3d310e5dcd3ba05e01ae6a770a465e58}{kNumTypes}}}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \};}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00079\ \ \ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{common_8h_ae8c57c7218a376f10cbdf0e50f1189ee}{force\_inline}}\ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}\ \mbox{\hyperlink{classvital_1_1_distortion_a56a544ecc89be64e2ab5efea006551e8}{driveDbScale}}(\mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}\ db)\ \{}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacevital_1_1futils_aeb7b7646b5c704ad5c1e23d4cb1a75f4}{futils::dbToMagnitude}}(\mbox{\hyperlink{namespacevital_1_1utils_a13a19cf68aa11afa58de96f14442003a}{utils::clamp}}(db,\ \mbox{\hyperlink{classvital_1_1_distortion_ad472bc3a67757613386b8ba90bf673a8}{kMinDrive}},\ \mbox{\hyperlink{classvital_1_1_distortion_aed211fec0b904006b5d3c9ae731fe58a}{kMaxDrive}}));}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00089\ \ \ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{common_8h_ae8c57c7218a376f10cbdf0e50f1189ee}{force\_inline}}\ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}\ \mbox{\hyperlink{classvital_1_1_distortion_af971d8d6c004b203f5f77f3eeed6e90c}{bitCrushScale}}(\mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}\ db)\ \{}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \textcolor{keyword}{constexpr}\ \mbox{\hyperlink{namespacevital_afcc17475a10ef776bbd2f11b64c1ddfb}{mono\_float}}\ kDriveScale\ =\ 1.0f\ /\ (\mbox{\hyperlink{classvital_1_1_distortion_aed211fec0b904006b5d3c9ae731fe58a}{Distortion::kMaxDrive}}\ -\/\ \mbox{\hyperlink{classvital_1_1_distortion_ad472bc3a67757613386b8ba90bf673a8}{Distortion::kMinDrive}});}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}\ drive\ =\ \mbox{\hyperlink{namespacevital_1_1utils_ab453d9dff7b875976c8c8e22047a8558}{utils::max}}(db\ -\/\ \mbox{\hyperlink{classvital_1_1_distortion_ad472bc3a67757613386b8ba90bf673a8}{kMinDrive}},\ 0.0f)\ *\ kDriveScale;}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacevital_1_1utils_a13a19cf68aa11afa58de96f14442003a}{utils::clamp}}(drive\ *\ drive,\ \mbox{\hyperlink{classvital_1_1_distortion_a65a6f3a0c1ff568722b507e013be3a84}{kMinDistortionMult}},\ 1.0f);}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00104\ \ \ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{common_8h_ae8c57c7218a376f10cbdf0e50f1189ee}{force\_inline}}\ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}\ \mbox{\hyperlink{classvital_1_1_distortion_a012a5cf6ab9522068863162d7628bf51}{downSampleScale}}(\mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}\ db)\ \{}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \textcolor{keyword}{constexpr}\ \mbox{\hyperlink{namespacevital_afcc17475a10ef776bbd2f11b64c1ddfb}{mono\_float}}\ kDriveScale\ =\ 1.0f\ /\ (\mbox{\hyperlink{classvital_1_1_distortion_aed211fec0b904006b5d3c9ae731fe58a}{Distortion::kMaxDrive}}\ -\/\ \mbox{\hyperlink{classvital_1_1_distortion_ad472bc3a67757613386b8ba90bf673a8}{Distortion::kMinDrive}});}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Normalize\ drive\ to\ [0..1],\ then\ invert\ and\ square\ it}}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}\ drive\ =\ \mbox{\hyperlink{namespacevital_1_1utils_ab453d9dff7b875976c8c8e22047a8558}{utils::max}}(db\ -\/\ \mbox{\hyperlink{classvital_1_1_distortion_ad472bc3a67757613386b8ba90bf673a8}{Distortion::kMinDrive}},\ 0.0f)\ *\ kDriveScale;}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ drive\ =\ -\/drive\ +\ 1.0f;}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ drive\ =\ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}(1.0f)\ /\ \mbox{\hyperlink{namespacevital_1_1utils_a13a19cf68aa11afa58de96f14442003a}{utils::clamp}}(drive\ *\ drive,\ \mbox{\hyperlink{classvital_1_1_distortion_a65a6f3a0c1ff568722b507e013be3a84}{Distortion::kMinDistortionMult}},\ 1.0f);}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacevital_1_1utils_ab453d9dff7b875976c8c8e22047a8558}{utils::max}}(drive\ *\ 0.99f,\ 1.0f)\ *\ \mbox{\hyperlink{classvital_1_1_distortion_a6a162ad093cd1ee7eaa758256831ac1e}{Distortion::kPeriodScale}};}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00121\ \ \ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}\ \mbox{\hyperlink{classvital_1_1_distortion_a2f2558e1b3cb710657f1afee178fcdf9}{getDriveValue}}(\textcolor{keywordtype}{int}\ type,\ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}\ input\_drive)\ \{}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (type\ ==\ \mbox{\hyperlink{classvital_1_1_distortion_af511263ce9c679a9e98470c18464d4eead27279cfd28160a8a2575474eae32e91}{kBitCrush}})}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classvital_1_1_distortion_af971d8d6c004b203f5f77f3eeed6e90c}{bitCrushScale}}(input\_drive);}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (type\ ==\ \mbox{\hyperlink{classvital_1_1_distortion_af511263ce9c679a9e98470c18464d4eeadf0070fef6b2c11dd41d0a417535eae7}{kDownSample}})}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classvital_1_1_distortion_a012a5cf6ab9522068863162d7628bf51}{downSampleScale}}(input\_drive);}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classvital_1_1_distortion_a56a544ecc89be64e2ab5efea006551e8}{driveDbScale}}(input\_drive);}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00137\ \ \ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}\ \mbox{\hyperlink{classvital_1_1_distortion_a8362ebcacf342fd10f075e3866103108}{getDrivenValue}}(\textcolor{keywordtype}{int}\ type,\ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}\ value,\ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}\ drive);}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00142\ \ \ \ \ \ \ \mbox{\hyperlink{classvital_1_1_distortion_ada38e16aeae38879afcd41025233d04c}{Distortion}}();}
\DoxyCodeLine{00143\ }
\DoxyCodeLine{00145\ \ \ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classvital_1_1_distortion_a5e2c0503b7bb74dcc3f30d962476bfc4}{\string~Distortion}}()\ \{\ \}}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00151\ \ \ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classvital_1_1_processor}{Processor}}*\ \mbox{\hyperlink{classvital_1_1_distortion_a2b2e6cb6ce5f0da946e520205bd734d0}{clone}}()\textcolor{keyword}{\ const\ override\ }\{}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{common_8h_ab6dc6a12600086762731fd406e501cf2}{VITAL\_ASSERT}}(\textcolor{keyword}{false});}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00161\ \ \ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classvital_1_1_distortion_a3e2e6cac16759f94ce59fddb888fffd9}{process}}(\textcolor{keywordtype}{int}\ num\_samples)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00169\ \ \ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classvital_1_1_distortion_a01af6ba501eece4e5660954141d6aca3}{processWithInput}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}*\ audio\_in,\ \textcolor{keywordtype}{int}\ num\_samples)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00184\ \ \ \ \ \ \ \textcolor{keyword}{template}<poly\_\textcolor{keywordtype}{float}(*distort)(poly\_\textcolor{keywordtype}{float},\ poly\_\textcolor{keywordtype}{float}),\ poly\_\textcolor{keywordtype}{float}(*scale)(poly\_\textcolor{keywordtype}{float})>}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classvital_1_1_distortion_a8ad7067fdd5726a672e4d8e1bf7e1d64}{processTimeInvariant}}(\textcolor{keywordtype}{int}\ num\_samples,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}*\ audio\_in,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}*\ drive,}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}*\ audio\_out);}
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00196\ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classvital_1_1_distortion_aa7619676b43c5f1b4261ceb12f183c69}{processDownSample}}(\textcolor{keywordtype}{int}\ num\_samples,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}*\ audio\_in,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}*\ drive,}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}*\ audio\_out);}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}\ last\_distorted\_value\_;}
\DoxyCodeLine{00204\ }
\DoxyCodeLine{00208\ \ \ \ \ \ \ \mbox{\hyperlink{structvital_1_1poly__float}{poly\_float}}\ current\_samples\_;}
\DoxyCodeLine{00209\ }
\DoxyCodeLine{00213\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ type\_;}
\DoxyCodeLine{00214\ }
\DoxyCodeLine{00215\ \ \ \ \ \ \ JUCE\_LEAK\_DETECTOR(\mbox{\hyperlink{classvital_1_1_distortion}{Distortion}})}
\DoxyCodeLine{00216\ \ \ \};}
\DoxyCodeLine{00217\ \}\ \textcolor{comment}{//\ namespace\ vital}}

\end{DoxyCode}
